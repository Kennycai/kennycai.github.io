<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://kennycai.github.io').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="docker中文教程：docker-practice docker官方文档：docker doc  安装Ubuntu安装1234567891011121314151617181920212223242526272829# 卸载旧版本sudo apt-get remove docker docker-engine docker.io containerd runc# 更新apt软件包索引并安装软件">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 学习笔记">
<meta property="og:url" content="https://kennycai.github.io/2021/04/03/tools/docker/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="docker中文教程：docker-practice docker官方文档：docker doc  安装Ubuntu安装1234567891011121314151617181920212223242526272829# 卸载旧版本sudo apt-get remove docker docker-engine docker.io containerd runc# 更新apt软件包索引并安装软件">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/docker-in-window-settings.png">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/docker.jpg">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/WSL-l-v.png">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/WSL-volume-path.png">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/docker%E7%BD%91%E7%BB%9C%E6%88%AA%E5%9B%BE.png">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/docker%E7%BD%91%E7%BB%9C%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/docker%E7%BD%91%E7%BB%9C%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F2.png">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/docker%E9%83%A8%E7%BD%B2springboot-dockfiles.png">
<meta property="og:image" content="https://kennycai.github.io/images/tools/docker/WSL%E8%AE%BE%E7%BD%AEdocker-compose.png">
<meta property="article:published_time" content="2021-04-03T17:00:54.000Z">
<meta property="article:modified_time" content="2025-10-07T15:15:47.912Z">
<meta property="article:author" content="Cai Kenny">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kennycai.github.io/images/tools/docker/docker-in-window-settings.png">

<link rel="canonical" href="https://kennycai.github.io/2021/04/03/tools/docker/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Docker 学习笔记 | Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kennycai.github.io/2021/04/03/tools/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Cai Kenny">
      <meta itemprop="description" content="A Programmer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker 学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-03 17:00:54" itemprop="dateCreated datePublished" datetime="2021-04-03T17:00:54+00:00">2021-04-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-10-07 15:15:47" itemprop="dateModified" datetime="2025-10-07T15:15:47+00:00">2025-10-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>docker中文教程：<a href="https://yeasy.gitbook.io/docker_practice/" target="_blank" rel="noopener">docker-practice</a></p>
<p>docker官方文档：<a href="https://docs.docker.com/" target="_blank" rel="noopener">docker doc</a></p>
</blockquote>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Ubuntu安装"><a href="#Ubuntu安装" class="headerlink" title="Ubuntu安装"></a>Ubuntu安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 卸载旧版本</span></span><br><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新apt软件包索引并安装软件包，以允许apt通过HTTPS使用存储库</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加Docker的官方GPG密钥</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加docker库</span></span><br><span class="line">echo \</span><br><span class="line">  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span><br><span class="line"><span class="meta">  $</span><span class="bash">(lsb_release -cs) stable<span class="string">" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装docker引擎</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动docker</span></span><br><span class="line">sudo service docker start</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试docker</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<h2 id="Ubuntu-WSL安装"><a href="#Ubuntu-WSL安装" class="headerlink" title="Ubuntu-WSL安装"></a>Ubuntu-WSL安装</h2><h3 id="docker-in-window-安装"><a href="#docker-in-window-安装" class="headerlink" title="docker in window 安装"></a>docker in window 安装</h3><ul>
<li>下载docker for window</li>
<li>配置公开没有TLS的守护进程<br><img src="/images/tools/docker/docker-in-window-settings.png" alt="docker-in-window-settings"></li>
</ul>
<h3 id="WSL-Ubuntu-Docker-设置"><a href="#WSL-Ubuntu-Docker-设置" class="headerlink" title="WSL Ubuntu Docker 设置"></a>WSL Ubuntu Docker 设置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新apt软件包索引并安装软件包，以允许apt通过HTTPS使用存储库</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加Docker的官方GPG密钥</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加docker库</span></span><br><span class="line">echo \</span><br><span class="line">  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span><br><span class="line"><span class="meta">  $</span><span class="bash">(lsb_release -cs) stable<span class="string">" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装docker引擎</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置允许非root用户访问（如果不设置则在执行脚本时可能会遇到权限错误）：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sudo usermod -aG docker <span class="variable">$USER</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过以下命令将WSL Docker连接至Windows下的Docker Dameon </span></span><br><span class="line">`echo "export DOCKER_HOST=tcp://localhost:2375" &gt;&gt; ~/.bashrc &amp;&amp; source ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试docker</span></span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>

<h1 id="Docker-常用命令"><a href="#Docker-常用命令" class="headerlink" title="Docker 常用命令"></a>Docker 常用命令</h1><h2 id="Docker-镜像命令"><a href="#Docker-镜像命令" class="headerlink" title="Docker 镜像命令"></a>Docker 镜像命令</h2><h3 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search IMAGE</span><br></pre></td></tr></table></figure>

<h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull</span><br></pre></td></tr></table></figure>

<h3 id="查看已下载镜像列表"><a href="#查看已下载镜像列表" class="headerlink" title="查看已下载镜像列表"></a>查看已下载镜像列表</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi</span><br></pre></td></tr></table></figure>


<h2 id="Docker-容器命令"><a href="#Docker-容器命令" class="headerlink" title="Docker 容器命令"></a>Docker 容器命令</h2><h3 id="新建容器并运行"><a href="#新建容器并运行" class="headerlink" title="新建容器并运行"></a>新建容器并运行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run IMAGE [COMMOND] [ARG...]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数</span></span><br><span class="line">--name  name 别名</span><br><span class="line">-d      后台方式运行</span><br><span class="line">-it     交互式运行，进入容器查看内容</span><br><span class="line">-p      指定容器端口 -p 8080:8080</span><br><span class="line">docker run centos</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建并运行容器，然后进入容器终端</span></span><br><span class="line">docker run -i -t  --name test centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker run -it centos /bin/bash</span><br><span class="line">[root@a86442f09d0a /]#</span><br></pre></td></tr></table></figure>

<h3 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exit 推出交互式节目，容器停止运行</span><br><span class="line">Ctrl + P 然后 ctrl + Q 退出交互式界面，容器在后台运行。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@a86442f09d0a /]# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<h3 id="查看容器"><a href="#查看容器" class="headerlink" title="查看容器"></a>查看容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-a 查看所有容器</span><br><span class="line">-q 只列出容器id</span><br><span class="line">docker ps -aq</span><br></pre></td></tr></table></figure>

<h3 id="移除容器"><a href="#移除容器" class="headerlink" title="移除容器"></a>移除容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-f 强制移除</span><br><span class="line"><span class="meta">$</span><span class="bash">(docker ps -aq) 将所有容器id作为参数传给rm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">docker rm -f $(docker ps -aq)  # 删除所有容器</span><br><span class="line">docker rm 容器id				  # 删除指定容器，不能删除正在进行的容器</span><br><span class="line">docker ps -aq|xargs docker rm  # 删除所有容器</span><br></pre></td></tr></table></figure>

<h3 id="启动和停止容器"><a href="#启动和停止容器" class="headerlink" title="启动和停止容器"></a>启动和停止容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id		# 启动容器</span><br><span class="line">docker restart 容器id		# 重启容器</span><br><span class="line">docker stop 容器id		# 停止当前正在运行容器</span><br><span class="line">docker kill 容器id		# 强制停止容器</span><br></pre></td></tr></table></figure>



<h2 id="容器其他命令"><a href="#容器其他命令" class="headerlink" title="容器其他命令"></a>容器其他命令</h2><h3 id="后台启动容器"><a href="#后台启动容器" class="headerlink" title="后台启动容器"></a>后台启动容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run -d 镜像名	需要有一个前台进程，docker发现没有应用，就会自动停止</span></span><br></pre></td></tr></table></figure>

<h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker logs -f -t --tail number</span></span><br><span class="line">--tail 查看多少条日志</span><br><span class="line">-t	   显示时间戳</span><br></pre></td></tr></table></figure>

<h3 id="查看容器进程信息"><a href="#查看容器进程信息" class="headerlink" title="查看容器进程信息"></a>查看容器进程信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker top</span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker top c31b06ca04f6</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                2539                2519                0                   03:44               ?                   00:00:00            /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="查看镜像元数据"><a href="#查看镜像元数据" class="headerlink" title="查看镜像元数据"></a>查看镜像元数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure>

<h3 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器id /bin/bash	# 进入容器后开启一个新的终端，打开一个新的命令行</span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker exec -it c31b06ca04f6 /bin/bash</span><br><span class="line">[root@c31b06ca04f6 /]#</span><br><span class="line"></span><br><span class="line">docker attach 容器id				# 进入容器当前正在执行的终端</span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker attach c31b06ca04f6</span><br><span class="line">[root@c31b06ca04f6 /]#</span><br></pre></td></tr></table></figure>

<h3 id="容器内的文件拷贝到容器外"><a href="#容器内的文件拷贝到容器外" class="headerlink" title="容器内的文件拷贝到容器外"></a>容器内的文件拷贝到容器外</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器目录文件 主机目录</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/images/tools/docker/docker.jpg" alt="Docker"></p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><h3 id="部署nginx"><a href="#部署nginx" class="headerlink" title="部署nginx"></a>部署nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拉取镜像</span></span><br><span class="line">docker pull nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行镜像</span></span><br><span class="line">-d 后台运行</span><br><span class="line">--name 别名</span><br><span class="line">-p 端口映射</span><br><span class="line">docker run -d --name nginx-test -p 3344:80 nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入nginx</span></span><br><span class="line">docker exec -it nginx-test /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="部署tomcat"><a href="#部署tomcat" class="headerlink" title="部署tomcat"></a>部署tomcat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run -it --rm tomcat 用完即删除容器 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拉取镜像</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行镜像</span></span><br><span class="line">-d 后台运行</span><br><span class="line">--name 别名</span><br><span class="line">-p 端口映射</span><br><span class="line">docker run -d --name tomcat-test -p 8080:8080 tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入tomcat</span></span><br><span class="line">docker exec -it tomcat-test /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="部署es-kibana"><a href="#部署es-kibana" class="headerlink" title="部署es+kibana"></a>部署es+kibana</h3><h1 id="Docker-镜像讲解"><a href="#Docker-镜像讲解" class="headerlink" title="Docker 镜像讲解"></a>Docker 镜像讲解</h1><h2 id="UninoFS（联合文件系统）"><a href="#UninoFS（联合文件系统）" class="headerlink" title="UninoFS（联合文件系统）"></a>UninoFS（联合文件系统）</h2><p>UninoFS：是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下，UninoFS文件系统是docker镜像的基础，镜像可以通过分层来实现的，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。<br>特性：一次同时加载多个文件系统，但是从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会保函所有底层的文件和目录。</p>
<h2 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h2><p>Docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统（UinnioFS）<br>（系统启动需要引导加载）黑屏-开机-显示屏幕 –加载<br>Bootfs（boot file system）主要包括bootloader和kernel，bootloader主要时引导加载kernal，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs，这一层与我们典型的Linux系统时一样的，包含boot加载器和内核，当boot加载完成之后整个内核都在内存中了，此时内存的使用权已有bootfs转交给内核，此时也会卸载bootfs。<br>Rootfs（root file system）在bootfs之上，包含的就是典型的linux系统中的/dev /proc /bin /etc 等标准目录和文件，rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos<br>对于一个精简的OS(内核)，rootfs可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用Host（主机的）的Kernel,自己只需要提供rootfs就可以了，由此可见对于不同的linux发行版，bootfs基本时一致的，因此不同的发行版可以公用bootfs</p>
<h2 id="分层的原理"><a href="#分层的原理" class="headerlink" title="分层的原理"></a>分层的原理</h2><p>所有的docker镜像都起始于一个基础镜像层，当进行修改或者增加新的内容时，就会在当前镜像层之上，创建新的镜像层，比如：假设基于Ubuntu Linux 16.04创建一个新的镜像，这就是新镜像的第一层，如果在该镜像中添加python包，就会在基础镜像层之上创建第二个镜像层，如果继续添加一个安全补丁，就会创建第三个镜像层，该镜像当前已经包含3个镜像层。<br>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要！<br>注意：假如在docker中又添加了python的最新版本，这时，docker并不会新增加一层，而是用最新版本的python替换了原来的旧版本python！</p>
<h2 id="提交镜像"><a href="#提交镜像" class="headerlink" title="提交镜像"></a>提交镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m='描述' -a='作者' 容器id 容器名:版本</span><br></pre></td></tr></table></figure>



<h1 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h1><p>容器数据卷提供了容器的持久化和同步操作！容器间也可以共享数据！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-v localpath:dockpath</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器删除，本地数据不会丢失</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:docker run -d -v F://workspace/dockerwolumn5:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7</span><br></pre></td></tr></table></figure>

<h2 id="匿名挂载、具名挂载、指定路径挂载"><a href="#匿名挂载、具名挂载、指定路径挂载" class="headerlink" title="匿名挂载、具名挂载、指定路径挂载"></a>匿名挂载、具名挂载、指定路径挂载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径			# 匿名挂载</span><br><span class="line">-v 具名:容器内路径		   # 具名挂载	</span><br><span class="line">-v /宿主机路径:容器内路径  # 指定路径挂载</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 匿名挂载 测试</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker run -d -v /var/lib/mysql mysql:5.7</span><br><span class="line">f28c24a185056025f0590862559d7cacaabf22e5e476f89b99f400a1193d18e7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 具名挂载 测试</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker run -d -v name:/var/lib/mysql mysql:5.7</span><br><span class="line">f28c24a185056025f0590862559d7cacaabf22e5e476f89b99f400a1193d18e7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器卷</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     8c45c1a0a7e6e0aa91a2f71fdf2a2f231bba25976e1e0cb541f7a05e753658fa</span><br><span class="line">local     9e20887c8eb3b6204706894316fd4f7c645f11959237721c1f46dbb997697008</span><br><span class="line">local     name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看容器卷信息</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker volume inspect 9e20887c8eb3b6204706894316fd4f7c645f11959237721c1f46dbb997697008</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "CreatedAt": "2021-03-23T13:31:36Z",</span><br><span class="line">        "Driver": "local",</span><br><span class="line">        "Labels": null,</span><br><span class="line">        "Mountpoint": "/var/lib/docker/volumes/9e20887c8eb3b6204706894316fd4f7c645f11959237721c1f46dbb997697008/_data",</span><br><span class="line">        "Name": "9e20887c8eb3b6204706894316fd4f7c645f11959237721c1f46dbb997697008",</span><br><span class="line">        "Options": null,</span><br><span class="line">        "Scope": "local"</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：docker in window 用的是虚拟机技术，容器卷的位置在浏览器访问以下指令可以进入.vhdx中 <code>\\wsl$\docker-desktop-data\version-pack-data\community\docker\volumes\</code> 查看</p>
</blockquote>
<p><img src="/images/tools/docker/WSL-l-v.png" alt="WSL-l-v"></p>
<p><img src="/images/tools/docker/WSL-volume-path.png" alt="WSL-volume-path.png"></p>
<p>扩展</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 容器内路径:ro rw 改变独写权限</span></span><br><span class="line">ro readonly  # 只读</span><br><span class="line">rw readwrite # 可读可写</span><br><span class="line"><span class="meta">#</span><span class="bash"> 一旦设置了容器权限，容器对挂载出来的内容就有了限定</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ro 只能通过宿主机改变，容器内部无法操作，默认rw</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker run -d -v name:/var/lib/mysql:ro mysql:5.7</span><br><span class="line">kennycai@DESKTOP-M38LAH7:~$ docker run -d -v name:/var/lib/mysql:rw mysql:5.7</span><br></pre></td></tr></table></figure>

<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><p>dockerfile 是用来构建docker镜像的文件</p>
<p>构建过程：</p>
<ol>
<li>构建一个dockerfile文件</li>
<li>docker build 构建成一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push 发布镜像（DockerHub，阿里云镜像仓库）</li>
</ol>
<h2 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h2><ol>
<li>每个报类关键字（指令）都是大写字母</li>
<li>执行从上到下的顺序</li>
<li>#表示注释</li>
<li>每一个指令都会创建提交一个新的镜像层。</li>
</ol>
<p>DokckerFile：构建文件，定义了一切的步骤，源代码</p>
<p>DockerImages：通过DockerFile 构建生成的镜像，最终发布和运行的产品</p>
<p>Docker容器：容器是镜像运行起来的服务</p>
<h2 id="DockerFile指令"><a href="#DockerFile指令" class="headerlink" title="DockerFile指令"></a>DockerFile指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM			# 基础镜像，一切从这里开始构建</span><br><span class="line">MAINTAINER  	# 镜像是谁写的，姓名+邮件</span><br><span class="line">RUN				# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD				# 添加内容</span><br><span class="line">WORKDIR			# 镜像的工作目录</span><br><span class="line">VOLUME			# 挂载的目录</span><br><span class="line">EXPOSE			# 暴露端口</span><br><span class="line">CMD				# 指定容器启动的时间要运行的命令，只有最后一个会生效，可被替代。(例如 CMD ["ls"，"-a"])，docker run -l，会替换成docker run -l</span><br><span class="line">ENTRYPOINT		# 指定这个容器启动的时候要运行的命令。(例如 CMD ["ls"，"-a"])，docker run -l，会替换成docker run ls -al</span><br><span class="line">ONBUILD			# 当构建一个被继承的 DockerFile时会运行 ONBUILD 的命令。</span><br><span class="line">COPY			# 类似ADD，将文件拷贝到镜像中</span><br><span class="line">ENV				# 构建时设置环境变量</span><br></pre></td></tr></table></figure>

<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编写dockerFile</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ cat dockerfile-centos</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER kennycai&lt;qq.qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV WORKPATH /usr/local</span><br><span class="line">WORKDIR $WORKPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $WORKPATH</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> build</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker build -f dockerfile-centos -t mycentos:0.1 .</span><br><span class="line">[+] Building 33.0s (8/8) FINISHED</span><br><span class="line"> =&gt; [internal] load build definition from dockerfile-centos                                            0.2s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 236B                                                                   0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                      0.2s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                        0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:latest                                       0.0s</span><br><span class="line"> =&gt; [1/4] FROM docker.io/library/centos                                                                0.1s</span><br><span class="line"> =&gt; [2/4] WORKDIR /usr/local                                                                           0.2s</span><br><span class="line"> =&gt; [3/4] RUN yum -y install vim                                                                       27.8s</span><br><span class="line"> =&gt; [4/4] RUN yum -y install net-tools                                                                 3.3s</span><br><span class="line"> =&gt; exporting to image                                                                                 0.9s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                0.9s</span><br><span class="line"> =&gt; =&gt; writing image sha256:01ffa757ed9ba3fba11c1a3e325e06799692207793f4e98b3820b2664a2d2062           0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/mycentos:0.1                                                        0.0s</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker run -it mycentos:0.1</span><br></pre></td></tr></table></figure>

<h2 id="docker-history"><a href="#docker-history" class="headerlink" title="docker history"></a>docker history</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">history</span></span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker history 01ffa757ed9b</span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">01ffa757ed9b   3 minutes ago   CMD ["/bin/sh" "-c" "/bin/bash"]                0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      3 minutes ago   CMD ["/bin/sh" "-c" "echo $WORKPATH"]           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      3 minutes ago   EXPOSE map[80/tcp:&#123;&#125;]                           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      3 minutes ago   RUN /bin/sh -c yum -y install net-tools # bu…   14.4MB    buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      3 minutes ago   RUN /bin/sh -c yum -y install vim # buildkit    58.1MB    buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 minutes ago   WORKDIR /usr/local                              0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 minutes ago   ENV WORKPATH=/usr/local                         0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 minutes ago   MAINTAINER kennycai&lt;qq.qq.com&gt;                  0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 months ago    /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B</span><br><span class="line">&lt;missing&gt;      4 months ago    /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B</span><br><span class="line">&lt;missing&gt;      4 months ago    /bin/sh -c #(nop) ADD file:bd7a2aed6ede423b7…   209MB</span><br></pre></td></tr></table></figure>

<h2 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h2><ol>
<li>注册Docker Hub账号</li>
<li>docker login -u</li>
<li>docker push username/镜像名:版本号</li>
</ol>
<h3 id="docker-tag"><a href="#docker-tag" class="headerlink" title="docker tag"></a>docker tag</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br></pre></td></tr></table></figure>

<h1 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的内部网络地址</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: sit0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/sit 0.0.0.0 brd 0.0.0.0</span><br><span class="line">89: eth0@if90: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta">#</span><span class="bash"> linux 可以ping通容器内部</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<ol>
<li>每启动一个容器，docker就会给容器创建一个 ip，只要安装了 docker，就会有一个网卡 <code>docker0</code>。使用的时 <code>evth-pair</code> 技术</li>
</ol>
<p><img src="/images/tools/docker/docker%E7%BD%91%E7%BB%9C%E6%88%AA%E5%9B%BE.png" alt="docker网络截图"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 容器的网卡都是一对对的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> evth-pair 就是一对的虚拟设备接口，他们都是成对出现的，一段连着协议，一段彼此相连</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正因为有这个特性，evth-pair 充当一个桥梁，连接各种虚拟网络设备</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>结论：tomcat01 和 tomcat02 是共用的一个路由器，docker0</p>
<p>Docker使用的是Linux的桥接，宿主机中是一个Docker容器的网桥，docker0</p>
</blockquote>
<p><img src="/images/tools/docker/docker%E7%BD%91%E7%BB%9C%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F.png" alt="docker网络桥接模式"></p>
<p><img src="/images/tools/docker/docker%E7%BD%91%E7%BB%9C%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F2.png" alt="docker网络桥接模式2"></p>
<h2 id="容器互联：–link（不建议使用）"><a href="#容器互联：–link（不建议使用）" class="headerlink" title="容器互联：–link（不建议使用）"></a>容器互联：–link（不建议使用）</h2><p>通过–link可以实现容器间通过服务名ping通</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker run -d -P --name tomcat03 --link tomcat01 tomcat</span><br><span class="line">b8be16b2097be91464061eff924238e3e13759c0320cd64b883bfca4dc472417</span><br><span class="line"></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker exec -it tomcat03 ping tomcat01</span><br><span class="line">PING tomcat01 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01 (172.17.0.2): icmp_seq=1 ttl=64 time=1.32 ms</span><br><span class="line">64 bytes from tomcat01 (172.17.0.2): icmp_seq=2 ttl=64 time=0.056 ms</span><br><span class="line">64 bytes from tomcat01 (172.17.0.2): icmp_seq=3 ttl=64 time=0.083 ms</span><br><span class="line">64 bytes from tomcat01 (172.17.0.2): icmp_seq=4 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from tomcat01 (172.17.0.2): icmp_seq=5 ttl=64 time=0.062 ms</span><br><span class="line">...</span><br><span class="line">^C</span><br><span class="line">--- tomcat01 ping statistics ---</span><br><span class="line">23 packets transmitted, 23 received, 0% packet loss, time 897ms</span><br><span class="line">rtt min/avg/max/mdev = 0.052/0.126/1.317/0.256 ms</span><br></pre></td></tr></table></figure>

<p>实现原理：–link就是在hosts配置中增加了一个tomcat01的配置 <code>172.17.0.2      tomcat01 7eecf4a94460</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看hosts配置</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.17.0.2      tomcat01 7eecf4a94460</span><br><span class="line">172.17.0.3      b8be16b2097b</span><br></pre></td></tr></table></figure>



<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><p>![docker网络-docker network ls](/images/tools/docker/docker网络-docker network ls.png)</p>
<p><strong>网络模式</strong></p>
<p>bridge：桥接 docker默认</p>
<p>none： 不配置网络</p>
<p>host： 和宿主机共享网络</p>
<p>container：容器网络连通（局限性大）</p>
<p><strong>自定义网络</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> --subnet			子网</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --gateway			网关</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --driver	bridge 	桥接模式</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">6807b08beb858a3d12e62b1dee81cf1c94a197053953a65a17b4d4d95f98e605</span><br><span class="line"></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">9ea2081e8adc   bridge    bridge    local</span><br><span class="line">24f027fd73ea   host      host      local</span><br><span class="line">6807b08beb85   mynet     bridge    local</span><br><span class="line">a302044f08b8   none      null      local</span><br></pre></td></tr></table></figure>

<p><strong>将服务创建在自己的网络中</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 --net 指定网络</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">28fd86ce9ed4d8a00071eba3acfe93fd967672fda76c939d0fdc8587e47d22c4</span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">b94e30b9a734f6ae71e6624971dfca5d8448013376e71000201564510179ab56</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看mynet信息</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynet",</span><br><span class="line">        "Id": "6807b08beb858a3d12e62b1dee81cf1c94a197053953a65a17b4d4d95f98e605",</span><br><span class="line">        "Created": "2021-04-11T03:55:18.2507775Z",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "28fd86ce9ed4d8a00071eba3acfe93fd967672fda76c939d0fdc8587e47d22c4": &#123;</span><br><span class="line">                "Name": "tomcat-net-01",</span><br><span class="line">                "EndpointID": "24c8810aa28a69360e47fd183d40d6aa32b4cc3437434627476e54e93d928ae8",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:02",</span><br><span class="line">                "IPv4Address": "192.168.0.2/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "b94e30b9a734f6ae71e6624971dfca5d8448013376e71000201564510179ab56": &#123;</span><br><span class="line">                "Name": "tomcat-net-02",</span><br><span class="line">                "EndpointID": "c07247228ae8d9e6da8001638ecfadc3e362f368f7f5db42a841e152a153dad2",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:03",</span><br><span class="line">                "IPv4Address": "192.168.0.3/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># tomcat-net-01 和 tomcat-net-02 可以通过服务名互相ping通，不需要使用--link</span></span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.231 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.062 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.066 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 51ms</span><br><span class="line">rtt min/avg/max/mdev = 0.062/0.119/0.231/0.079 ms</span><br><span class="line"></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker exec -it tomcat-net-02 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.411 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.062 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 3ms</span><br><span class="line">rtt min/avg/max/mdev = 0.062/0.236/0.411/0.175 ms</span><br></pre></td></tr></table></figure>

<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><p>不同的两个网络间的容器连接的问题，如docker0网络下的tomcat01访问mynet</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建两个在docker0的容器</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker run -d -P --name tomcat02 tomcat</span><br><span class="line">ef7273a12c8c6becae8450a3ec728e7753a6e7adc9ad9fe73f814c04c0c741a9</span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line">27150369994eb0933dabd7bf4a889b31c7b5d146d7e0bd80adf81521da87b80b</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> tomcat01连接mynet网络</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker network connect mynet tomcat01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看mynet信息，containers中多了一个tomcat01</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynet",</span><br><span class="line">        "Id": "6807b08beb858a3d12e62b1dee81cf1c94a197053953a65a17b4d4d95f98e605",</span><br><span class="line">        "Created": "2021-04-11T03:55:18.2507775Z",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "27150369994eb0933dabd7bf4a889b31c7b5d146d7e0bd80adf81521da87b80b": &#123;</span><br><span class="line">                "Name": "tomcat01",</span><br><span class="line">                "EndpointID": "9addff770af1f15cba77c92cf95658b3f5877e697c6f653b503e681d3cf47552",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:04",</span><br><span class="line">                "IPv4Address": "192.168.0.4/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "28fd86ce9ed4d8a00071eba3acfe93fd967672fda76c939d0fdc8587e47d22c4": &#123;</span><br><span class="line">                "Name": "tomcat-net-01",</span><br><span class="line">                "EndpointID": "24c8810aa28a69360e47fd183d40d6aa32b4cc3437434627476e54e93d928ae8",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:02",</span><br><span class="line">                "IPv4Address": "192.168.0.2/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "b94e30b9a734f6ae71e6624971dfca5d8448013376e71000201564510179ab56": &#123;</span><br><span class="line">                "Name": "tomcat-net-02",</span><br><span class="line">                "EndpointID": "c07247228ae8d9e6da8001638ecfadc3e362f368f7f5db42a841e152a153dad2",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:03",</span><br><span class="line">                "IPv4Address": "192.168.0.3/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ping测试</span></span><br><span class="line">kennycai@DESKTOP-M38LAH7:~/dockerfile$ docker exec -it tomcat01 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=1.18 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 1.177/1.177/1.177/0.000 ms</span><br></pre></td></tr></table></figure>



<h1 id="SpringBoot微服务打包Docker镜像"><a href="#SpringBoot微服务打包Docker镜像" class="headerlink" title="SpringBoot微服务打包Docker镜像"></a>SpringBoot微服务打包Docker镜像</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 构建一个spring boot项目</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打包应用</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编写dockerfiles</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将dockerfiles和.jar用docker build打包</span></span><br><span class="line">docker build -t springboot .</span><br><span class="line"><span class="meta">#</span><span class="bash"> 发布</span></span><br><span class="line">docker run -d -P --name springbootTest springboot</span><br></pre></td></tr></table></figure>

<p><img src="/images/tools/docker/docker%E9%83%A8%E7%BD%B2springboot-dockfiles.png" alt="docker部署springboot-dockfiles"></p>
<h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Docker Compose 来轻松高效的管理容器，定义运行多个容器</p>
<blockquote>
<p>官方文档</p>
</blockquote>
<p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose, see <a href="https://docs.docker.com/compose/#features" target="_blank" rel="noopener">the list of features</a>.</p>
<p>Compose works in all environments: production, staging, development, testing, as well as CI workflows. You can learn more about each case in <a href="https://docs.docker.com/compose/#common-use-cases" target="_blank" rel="noopener">Common Use Cases</a>.</p>
<p>Using Compose is basically a three-step process:</p>
<ol>
<li>Define your app’s environment with a <code>Dockerfile</code> so it can be reproduced anywhere.</li>
<li>Define the services that make up your app in <code>docker-compose.yml</code> so they can be run together in an isolated environment.</li>
<li>Run <code>docker compose up</code> and the <a href="https://docs.docker.com/compose/cli-command/" target="_blank" rel="noopener">Docker compose command</a> starts and runs your entire app. You can alternatively run <code>docker-compose up</code> using the docker-compose binary.</li>
</ol>
<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>在WSL中使用docker-compose</p>
<ol>
<li><p><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" target="_blank" rel="noopener">升级WSL -&gt; WSL2</a></p>
</li>
<li><p>设置docker</p>
<p><img src="/images/tools/docker/WSL%E8%AE%BE%E7%BD%AEdocker-compose.png" alt="WSL设置docker-compose"></p>
</li>
</ol>
<h2 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h2><p><a href="https://docs.docker.com/compose/gettingstarted/" target="_blank" rel="noopener">https://docs.docker.com/compose/gettingstarted/</a></p>
<h1 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h1><p>集群方式的部署。</p>
<blockquote>
<p>通过 hyper-v 和 docker-machine 测试 Docker Swarm</p>
</blockquote>
<ol>
<li><p>win10家庭版安装 <code>hyper-v</code>，创建 <code>hyper.cmd</code>并执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pushd "%~dp0"</span><br><span class="line"></span><br><span class="line">dir /b %SystemRoot%\servicing\Packages\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class="line"></span><br><span class="line">for /f %%i in ('findstr /i . hyper-v.txt 2^&gt;nul') do dism /online /norestart /add-package:"%SystemRoot%\servicing\Packages\%%i"</span><br><span class="line"></span><br><span class="line">del hyper-v.txt</span><br><span class="line"></span><br><span class="line">Dism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>git bash 安装 <a href="https://github.com/docker/machine/releases/" target="_blank" rel="noopener">docker-machine</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if [[ ! -d "$HOME/bin" ]]; then mkdir -p "$HOME/bin"; fi &amp;&amp; \</span><br><span class="line">curl -L https://github.com/docker/machine/releases/download/v0.16.2/docker-machine-Windows-x86_64.exe &gt; "$HOME/bin/docker-machine.exe" &amp;&amp; \</span><br><span class="line">chmod +x "$HOME/bin/docker-machine.exe"</span><br></pre></td></tr></table></figure>
</li>
<li><p>在管理员模式下的 <code>PowerShell</code>通过 <code>docker-machine</code> 启动多个docker服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\docker-machine.exe create -d hyperv --hyperv-virtual-switch "Docker Switch" docker01</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Swarm集群搭建"><a href="#Swarm集群搭建" class="headerlink" title="Swarm集群搭建"></a>Swarm集群搭建</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker swarm init --advertise-addr 192.168.0.116</span><br><span class="line">Swarm initialized: current node (fb5pef6fmfrwlrkppxinzvbnd) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-0lmn5xnc14rmu20jcli9fo90puoru690w1es1bj3ejdvyq1x7d-d1aducb67lur4jry8bkvzxzll 192.168.0.116:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># centos02加入节点，出现问题</span></span></span><br><span class="line">[root@localhost ~]# docker swarm join --token SWMTKN-1-0lmn5xnc14rmu20jcli9fo90puoru690w1es1bj3ejdvyq1x7d-d1aducb67lur4jry8bkvzxzll 192.168.0.116:2377</span><br><span class="line">Error response from daemon: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing dial tcp 192.168.0.116:2377: connect: no route to host"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># centos关闭防火墙</span></span></span><br><span class="line">[root@localhost ~]# systemctl status firewalld.service</span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor p&gt;</span><br><span class="line">   Active: active (running) since Wed 2021-04-14 10:42:15 EDT; 9h ago</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"> Main PID: 827 (firewalld)</span><br><span class="line">    Tasks: 3 (limit: 10970)</span><br><span class="line">   Memory: 31.5M</span><br><span class="line">   CGroup: /system.slice/firewalld.service</span><br><span class="line">           └─827 /usr/libexec/platform-python -s /usr/sbin/firewalld --nofork -&gt;</span><br><span class="line"></span><br><span class="line">4月 14 20:06:35 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:35 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:35 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:35 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:35 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:36 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:47 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:47 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:06:48 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line">4月 14 20:20:29 localhost.localdomain firewalld[827]: WARNING: COMMAND_FAILED: &gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 停止防火墙</span></span></span><br><span class="line">[root@localhost ~]# systemctl stop firewalld.service</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 永久停止</span></span></span><br><span class="line">[root@localhost ~]# systemctl disable firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># centos02加入节点</span></span></span><br><span class="line">[root@localhost ~]# docker swarm join --token SWMTKN-1-0lmn5xnc14rmu20jcli9fo90puoru690w1es1bj3ejdvyq1x7d-d1aducb67lur4jry8bkvzxzll 192.168.0.116:2377</span><br><span class="line">This node joined a swarm as a worker.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">centos01</span></span><br><span class="line">[root@localhost ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">fb5pef6fmfrwlrkppxinzvbnd *   localhost.localdomain   Ready     Active         Leader           20.10.6</span><br><span class="line">ns60lgtjv513aq9z5qtoye907     localhost.localdomain   Ready     Active                          20.10.6</span><br></pre></td></tr></table></figure>

<h2 id="Raft一致性协议"><a href="#Raft一致性协议" class="headerlink" title="Raft一致性协议"></a>Raft一致性协议</h2><h2 id="Swarm集群弹性创建服务"><a href="#Swarm集群弹性创建服务" class="headerlink" title="Swarm集群弹性创建服务"></a>Swarm集群弹性创建服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker01</span></span><br><span class="line">[root@localhost ~]# docker service create -p 8080:80 --name my-nginx nginx</span><br><span class="line">nmynl6p33cl4jqoano3fpzn3j</span><br><span class="line">overall progress: 1 out of 1 tasks</span><br><span class="line">1/1: running</span><br><span class="line">verify: Service converged</span><br><span class="line"></span><br><span class="line">Usage:  docker service ps [OPTIONS] SERVICE [SERVICE...]</span><br><span class="line"></span><br><span class="line">List the tasks of one or more services</span><br><span class="line">[root@localhost ~]# docker service ls</span><br><span class="line">ID             NAME       MODE         REPLICAS   IMAGE          PORTS</span><br><span class="line">nmynl6p33cl4   my-nginx   replicated   1/1        nginx:latest   *:8080-&gt;80/tcp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动三个服务</span></span><br><span class="line">[root@localhost ~]# docker service update --replicas 3 my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 3 out of 3 tasks</span><br><span class="line">1/3: running</span><br><span class="line">2/3: running</span><br><span class="line">3/3: running</span><br><span class="line">verify: Service converged</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">1804a322cd1d   nginx:latest   "/docker-entrypoint.…"   25 seconds ago   Up 17 seconds   80/tcp    my-nginx.3.jz21l94iade4ftama01afs2h8</span><br><span class="line">ccf3c9dc75db   nginx:latest   "/docker-entrypoint.…"   25 seconds ago   Up 18 seconds   80/tcp    my-nginx.2.p70k9b4bxznsog17wo1lrsui6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> centos02</span></span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">b0483ca45a0f   nginx:latest   "/docker-entrypoint.…"   3 minutes ago   Up 3 minutes   80/tcp    my-nginx.1.pukcavrwqugxs47p91g0ttxee</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> centos01</span></span><br><span class="line">[root@localhost ~]# docker service scale my-nginx=5</span><br><span class="line">my-nginx scaled to 5</span><br><span class="line">overall progress: 5 out of 5 tasks</span><br><span class="line">1/5: running   [==================================================&gt;]</span><br><span class="line">2/5: running   [==================================================&gt;]</span><br><span class="line">3/5: running   [==================================================&gt;]</span><br><span class="line">4/5: running   [==================================================&gt;]</span><br><span class="line">5/5: running   [==================================================&gt;]</span><br><span class="line">verify: Service converged</span><br></pre></td></tr></table></figure>

<p>访问nginx <a href="http://192.168.0.115:8080/" target="_blank" rel="noopener">http://192.168.0.115:8080/</a>  <a href="http://192.168.0.116:8080/" target="_blank" rel="noopener">http://192.168.0.116:8080/</a></p>
<p>![docker-swarm niginx启动成功]((/images/tools/docker/docker-swarm niginx启动成功.png)</p>
<h1 id="Docker-Stack"><a href="#Docker-Stack" class="headerlink" title="Docker Stack"></a>Docker Stack</h1><p>集群版docker-compose</p>
<h1 id="Docker-Secret"><a href="#Docker-Secret" class="headerlink" title="Docker Secret"></a>Docker Secret</h1><p>安全配置，存储密钥</p>
<h1 id="Docker-Config"><a href="#Docker-Config" class="headerlink" title="Docker Config"></a>Docker Config</h1><p>存储配置</p>
<h1 id="常用环境"><a href="#常用环境" class="headerlink" title="常用环境"></a>常用环境</h1><h2 id="ES"><a href="#ES" class="headerlink" title="ES"></a>ES</h2><p><a href="/resources/tools/docker/docker-ES.7z">docker-ES.7z</a></p>
<blockquote>
<p>logstash.conf</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    mode &#x3D;&gt; &quot;server&quot;</span><br><span class="line">    host &#x3D;&gt; &quot;0.0.0.0&quot;</span><br><span class="line">    port &#x3D;&gt; 4560</span><br><span class="line">    codec &#x3D;&gt; json_lines</span><br><span class="line">    type &#x3D;&gt; &quot;debug&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    mode &#x3D;&gt; &quot;server&quot;</span><br><span class="line">    host &#x3D;&gt; &quot;0.0.0.0&quot;</span><br><span class="line">    port &#x3D;&gt; 4561</span><br><span class="line">    codec &#x3D;&gt; json_lines</span><br><span class="line">    type &#x3D;&gt; &quot;error&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    mode &#x3D;&gt; &quot;server&quot;</span><br><span class="line">    host &#x3D;&gt; &quot;0.0.0.0&quot;</span><br><span class="line">    port &#x3D;&gt; 4562</span><br><span class="line">    codec &#x3D;&gt; json_lines</span><br><span class="line">    type &#x3D;&gt; &quot;business&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    mode &#x3D;&gt; &quot;server&quot;</span><br><span class="line">    host &#x3D;&gt; &quot;0.0.0.0&quot;</span><br><span class="line">    port &#x3D;&gt; 4563</span><br><span class="line">    codec &#x3D;&gt; json_lines</span><br><span class="line">    type &#x3D;&gt; &quot;record&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter&#123;</span><br><span class="line">  if [type] &#x3D;&#x3D; &quot;record&quot; &#123;</span><br><span class="line">    mutate &#123;</span><br><span class="line">      remove_field &#x3D;&gt; &quot;port&quot;</span><br><span class="line">      remove_field &#x3D;&gt; &quot;host&quot;</span><br><span class="line">      remove_field &#x3D;&gt; &quot;@version&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    json &#123;</span><br><span class="line">      source &#x3D;&gt; &quot;message&quot;</span><br><span class="line">      remove_field &#x3D;&gt; [&quot;message&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts &#x3D;&gt; &quot;elasticsearch:9200&quot;</span><br><span class="line">    index &#x3D;&gt; &quot;mall-%&#123;type&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>docker-compose.yml</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.13.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"cluster.name=elasticsearch"</span> <span class="comment">#设置集群名称为elasticsearch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"discovery.type=single-node"</span> <span class="comment">#以单一节点模式启动</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span> <span class="comment">#设置使用jvm内存大小</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">D:\workspace\env\docker\elasticsearch\plugins:/usr/share/elasticsearch/plugins</span> <span class="comment">#插件文件挂载</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">D:\workspace\env\docker\elasticsearch\data:/usr/share/elasticsearch/data</span> <span class="comment">#数据文件挂载</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9300</span><span class="string">:9300</span></span><br><span class="line">  <span class="attr">logstash:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">logstash:7.13.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">logstash</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">D:\workspace\env\docker\logstash\logstash.conf:/usr/share/logstash/pipeline/logstash.conf</span> <span class="comment">#挂载logstash的配置文件</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span> <span class="comment">#kibana在elasticsearch启动之后再启动</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">4560</span><span class="string">:4560</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">4561</span><span class="string">:4561</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">4562</span><span class="string">:4562</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">4563</span><span class="string">:4563</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kibana:7.13.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span> <span class="comment">#kibana在elasticsearch启动之后再启动</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"elasticsearch.hosts=http://elasticsearch:9200"</span> <span class="comment">#设置访问elasticsearch的地址</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5601</span><span class="string">:5601</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">        <span class="attr">external:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">net-env</span></span><br></pre></td></tr></table></figure>

<p>进入docker-compose文件目录 docker compose up -d</p>
<h3 id="logstash-安装不成功"><a href="#logstash-安装不成功" class="headerlink" title="logstash(安装不成功)"></a>logstash(安装不成功)</h3><blockquote>
<p>需要安装<code>json_lines</code>插件，并重新启动。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it logstash /bin/bash</span><br><span class="line">logstash-plugin install logstash-codec-json_lines</span><br><span class="line">docker restart logstash</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Docker/" rel="tag"># Docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/01/java/Thread/" rel="prev" title="线程、ThreadLocal">
      <i class="fa fa-chevron-left"></i> 线程、ThreadLocal
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/04/03/algorithm/algorithm/" rel="next" title="algorithm 学习笔记">
      algorithm 学习笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安装"><span class="nav-number">1.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ubuntu安装"><span class="nav-number">1.1.</span> <span class="nav-text">Ubuntu安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ubuntu-WSL安装"><span class="nav-number">1.2.</span> <span class="nav-text">Ubuntu-WSL安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-in-window-安装"><span class="nav-number">1.2.1.</span> <span class="nav-text">docker in window 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WSL-Ubuntu-Docker-设置"><span class="nav-number">1.2.2.</span> <span class="nav-text">WSL Ubuntu Docker 设置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-常用命令"><span class="nav-number">2.</span> <span class="nav-text">Docker 常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-镜像命令"><span class="nav-number">2.1.</span> <span class="nav-text">Docker 镜像命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#搜索镜像"><span class="nav-number">2.1.1.</span> <span class="nav-text">搜索镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下载镜像"><span class="nav-number">2.1.2.</span> <span class="nav-text">下载镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看已下载镜像列表"><span class="nav-number">2.1.3.</span> <span class="nav-text">查看已下载镜像列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除镜像"><span class="nav-number">2.1.4.</span> <span class="nav-text">删除镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-容器命令"><span class="nav-number">2.2.</span> <span class="nav-text">Docker 容器命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#新建容器并运行"><span class="nav-number">2.2.1.</span> <span class="nav-text">新建容器并运行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#退出"><span class="nav-number">2.2.2.</span> <span class="nav-text">退出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看容器"><span class="nav-number">2.2.3.</span> <span class="nav-text">查看容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除容器"><span class="nav-number">2.2.4.</span> <span class="nav-text">移除容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动和停止容器"><span class="nav-number">2.2.5.</span> <span class="nav-text">启动和停止容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#容器其他命令"><span class="nav-number">2.3.</span> <span class="nav-text">容器其他命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#后台启动容器"><span class="nav-number">2.3.1.</span> <span class="nav-text">后台启动容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看日志"><span class="nav-number">2.3.2.</span> <span class="nav-text">查看日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看容器进程信息"><span class="nav-number">2.3.3.</span> <span class="nav-text">查看容器进程信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看镜像元数据"><span class="nav-number">2.3.4.</span> <span class="nav-text">查看镜像元数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进入当前正在运行的容器"><span class="nav-number">2.3.5.</span> <span class="nav-text">进入当前正在运行的容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器内的文件拷贝到容器外"><span class="nav-number">2.3.6.</span> <span class="nav-text">容器内的文件拷贝到容器外</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">2.4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#练习"><span class="nav-number">2.5.</span> <span class="nav-text">练习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#部署nginx"><span class="nav-number">2.5.1.</span> <span class="nav-text">部署nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#部署tomcat"><span class="nav-number">2.5.2.</span> <span class="nav-text">部署tomcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#部署es-kibana"><span class="nav-number">2.5.3.</span> <span class="nav-text">部署es+kibana</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-镜像讲解"><span class="nav-number">3.</span> <span class="nav-text">Docker 镜像讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#UninoFS（联合文件系统）"><span class="nav-number">3.1.</span> <span class="nav-text">UninoFS（联合文件系统）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker镜像加载原理"><span class="nav-number">3.2.</span> <span class="nav-text">Docker镜像加载原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分层的原理"><span class="nav-number">3.3.</span> <span class="nav-text">分层的原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提交镜像"><span class="nav-number">3.4.</span> <span class="nav-text">提交镜像</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#容器数据卷"><span class="nav-number">4.</span> <span class="nav-text">容器数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#匿名挂载、具名挂载、指定路径挂载"><span class="nav-number">4.1.</span> <span class="nav-text">匿名挂载、具名挂载、指定路径挂载</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DockerFile"><span class="nav-number">5.</span> <span class="nav-text">DockerFile</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DockerFile构建过程"><span class="nav-number">5.1.</span> <span class="nav-text">DockerFile构建过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DockerFile指令"><span class="nav-number">5.2.</span> <span class="nav-text">DockerFile指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实战"><span class="nav-number">5.3.</span> <span class="nav-text">实战</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-history"><span class="nav-number">5.4.</span> <span class="nav-text">docker history</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#发布镜像"><span class="nav-number">5.5.</span> <span class="nav-text">发布镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-tag"><span class="nav-number">5.5.1.</span> <span class="nav-text">docker tag</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-网络"><span class="nav-number">6.</span> <span class="nav-text">Docker 网络</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础知识"><span class="nav-number">6.1.</span> <span class="nav-text">基础知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#容器互联：–link（不建议使用）"><span class="nav-number">6.2.</span> <span class="nav-text">容器互联：–link（不建议使用）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义网络"><span class="nav-number">6.3.</span> <span class="nav-text">自定义网络</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络连通"><span class="nav-number">6.4.</span> <span class="nav-text">网络连通</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringBoot微服务打包Docker镜像"><span class="nav-number">7.</span> <span class="nav-text">SpringBoot微服务打包Docker镜像</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-Compose"><span class="nav-number">8.</span> <span class="nav-text">Docker Compose</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">8.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-1"><span class="nav-number">8.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#体验"><span class="nav-number">8.3.</span> <span class="nav-text">体验</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-Swarm"><span class="nav-number">9.</span> <span class="nav-text">Docker Swarm</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Swarm集群搭建"><span class="nav-number">9.1.</span> <span class="nav-text">Swarm集群搭建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Raft一致性协议"><span class="nav-number">9.2.</span> <span class="nav-text">Raft一致性协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Swarm集群弹性创建服务"><span class="nav-number">9.3.</span> <span class="nav-text">Swarm集群弹性创建服务</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-Stack"><span class="nav-number">10.</span> <span class="nav-text">Docker Stack</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-Secret"><span class="nav-number">11.</span> <span class="nav-text">Docker Secret</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-Config"><span class="nav-number">12.</span> <span class="nav-text">Docker Config</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用环境"><span class="nav-number">13.</span> <span class="nav-text">常用环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ES"><span class="nav-number">13.1.</span> <span class="nav-text">ES</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#logstash-安装不成功"><span class="nav-number">13.1.1.</span> <span class="nav-text">logstash(安装不成功)</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Cai Kenny</p>
  <div class="site-description" itemprop="description">A Programmer</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cai Kenny</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
